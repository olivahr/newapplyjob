<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Aplicaci√≥n de Empleo</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#475569;
  --line:#e5e7eb;
  --blue:#2563eb;
  --blue2:#1d4ed8;
  --mint:#d7f3ec;
  --mintB:#b6eadc;
  --radius:18px;
}
html{-webkit-text-size-adjust:100%;text-size-adjust:100%;}
*{box-sizing:border-box;font-family:Inter,sans-serif}
body{margin:0;background:var(--bg);color:var(--text)}
a{color:var(--blue);text-decoration:none}
strong{font-weight:700}

/* Layout */
.app{
  max-width:1120px;
  margin:26px auto;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:0 20px 60px rgba(0,0,0,.12);
  padding:28px;
  display:grid;
  grid-template-columns: 1fr;
  gap:18px;
}

/* Header */
.top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding-bottom:10px;
  border-bottom:1px solid var(--line);
}
.brand{font-weight:900;letter-spacing:.2px}
.top-actions{
  display:flex;
  gap:10px;
  align-items:center;
}
.step-pill{
  font-size:13px;
  color:var(--muted);
  background:#f8fafc;
  border:1px solid var(--line);
  padding:8px 12px;
  border-radius:999px;
  display:flex;
  gap:10px;
  align-items:center;
  white-space:nowrap;
}
.open-map-btn{
  border:none;
  background:#eef2ff;
  color:var(--blue2);
  font-weight:900;
  padding:10px 14px;
  border-radius:999px;
  cursor:pointer;
}
.open-map-btn:hover{filter:brightness(.98)}

/* Form */
.panel{padding:0}
h2{font-size:22px;margin:0 0 14px}
p{font-size:14px;color:#334155;line-height:1.8;margin:0 0 12px}
.form-step{display:none}
.form-step.active{display:block}

/* Inputs */
label{
  display:block;
  margin-top:18px;
  font-size:14px;
  font-weight:800;
  color:#0f172a;
}
input,select,textarea{
  width:100%;
  padding:14px;
  margin-top:6px;
  border:1px solid #d1d5db;
  border-radius:12px;
  font-size:16px; /* iPhone no zoom */
  outline:none;
  background:#fff;
}
input:focus,select:focus,textarea:focus{
  border-color:#60a5fa;
  box-shadow:0 0 0 4px rgba(59,130,246,.15);
}
textarea{min-height:110px;resize:vertical}

/* Checkbox rows */
.check{
  display:flex;
  gap:10px;
  margin-top:14px;
  font-size:14px;
  color:#0f172a;
  align-items:flex-start;
}
.check input{width:18px;height:18px;margin-top:2px}

/* Buttons */
.buttons{
  display:flex;
  justify-content:space-between;
  gap:12px;
  margin-top:26px;
  padding-top:12px;
  border-top:1px solid var(--line);
}
button{
  padding:14px 22px;
  border:none;
  border-radius:999px;
  font-size:14px;
  font-weight:900;
  cursor:pointer;
}
.prev{background:#e5e7eb;color:#111827}
.next{background:var(--blue);color:#fff}
.next:hover{background:var(--blue2)}
button:disabled{opacity:.45;pointer-events:none}

/* Assessment 9-18 */
.form-step[data-step="9"] label,
.form-step[data-step="10"] label,
.form-step[data-step="11"] label,
.form-step[data-step="12"] label,
.form-step[data-step="13"] label,
.form-step[data-step="14"] label,
.form-step[data-step="15"] label,
.form-step[data-step="16"] label,
.form-step[data-step="17"] label,
.form-step[data-step="18"] label{
  margin-top:10px;
  font-weight:800;
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 12px;
  border:1px solid var(--line);
  border-radius:12px;
  background:#fff;
  cursor:pointer;
}
.form-step[data-step="9"] label input,
.form-step[data-step="10"] label input,
.form-step[data-step="11"] label input,
.form-step[data-step="12"] label input,
.form-step[data-step="13"] label input,
.form-step[data-step="14"] label input,
.form-step[data-step="15"] label input,
.form-step[data-step="16"] label input,
.form-step[data-step="17"] label input,
.form-step[data-step="18"] label input{
  width:18px;height:18px;margin:0;
}
.pair-error{
  background:#fef2f2;
  border:1px solid #fecaca;
  padding:10px 12px;
  border-radius:12px;
}

/* Mobile fix */
@media (max-width: 920px){
  .app{
    margin:0;
    border-radius:0;
    padding:16px;
  }
}

/* =================== MAPA FULL SCREEN =================== */
.map-full{
  position:fixed;
  inset:0;
  background:#fff;
  z-index:99990;
  display:none;
  flex-direction:column;
}
.map-full.show{display:flex;}

.map-full-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:14px 16px;
  border-bottom:1px solid var(--line);
}
.map-full-title{
  font-weight:900;
  font-size:16px;
  color:var(--text);
}
.map-close{
  border:none;
  background:#eef2ff;
  color:var(--blue2);
  font-weight:900;
  padding:10px 14px;
  border-radius:999px;
  cursor:pointer;
}
.map-close:hover{filter:brightness(.98)}

.map-full-body{
  padding:14px 16px;
  overflow:auto;
  -webkit-overflow-scrolling:touch;
  flex:1;
}
.map-grid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0,1fr));
  gap:12px;
}
@media (min-width: 720px){
  .map-grid{ grid-template-columns: repeat(6, minmax(0,1fr)); }
}
.map-tile{
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
  cursor:pointer;
  user-select:none;
  display:flex;
  flex-direction:column;
  gap:8px;
  min-height:86px;
  background:#fff;
}
.map-tile:hover{ background:#f8fafc; }
.map-num{
  width:34px;height:34px;
  border-radius:999px;
  display:flex;align-items:center;justify-content:center;
  font-weight:900;
  border:2px solid #d1d5db;
  background:#f3f4f6;
  color:#64748b;
}
.map-name{
  font-size:12px;
  font-weight:800;
  color:#334155;
  line-height:1.2;
}
.map-tile.done .map-num{
  background:var(--mint);
  border-color:var(--mintB);
  color:#1b8f6a;
}
.map-tile.active .map-num{
  background:var(--blue);
  border-color:transparent;
  color:#fff;
}
.map-tile.locked{ opacity:.5; cursor:not-allowed; }

.map-full-footer{
  border-top:1px solid var(--line);
  padding:12px 16px;
  display:flex;
  justify-content:flex-end;
  gap:10px;
}
.map-primary{
  border:none;
  background:var(--blue);
  color:#fff;
  font-weight:900;
  padding:12px 18px;
  border-radius:999px;
  cursor:pointer;
}
.map-primary:hover{ background:var(--blue2); }

/* =================== FINAL BLANCO + CONFETTI =================== */
.final-screen{
  position:fixed;
  inset:0;
  background:#fff;
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99998;
  padding:18px;
}
.final-screen.show{display:flex;}
.final-card{
  width:min(560px,100%);
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:18px;
  box-shadow:0 20px 60px rgba(0,0,0,.14);
  text-align:center;
}
.final-card h3{
  margin:6px 0 6px;
  font-size:18px;
  font-weight:900;
  color:#0f172a;
}
.final-card p{
  margin:0;
  color:#334155;
  font-size:14px;
  line-height:1.5;
}
#confettiCanvas{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:99999;
}
</style>
</head>

<body>

<div class="app">
  <div class="top">
    <div class="brand">Aplicaci√≥n de Empleo</div>
    <div class="top-actions">
      <button type="button" class="open-map-btn" id="openMapBtn">Ver mapa</button>
      <div class="step-pill">
        <span id="stepCounter">Paso 1 de 18</span>
        <span>‚Ä¢</span>
        <span id="timeHint">Aprox. 20‚Äì35 min</span>
      </div>
    </div>
  </div>

  <main class="panel">
    <form id="wizard" novalidate>

      <!-- PASO 1 -->
      <section class="form-step active" data-step="1">
        <h2>Paso 1 ‚Äî Bienvenida a la aplicaci√≥n</h2>
        <p>
          Gracias por tu inter√©s en participar en operaciones corporativas de gran escala.
          Esta aplicaci√≥n corresponde a una <strong>evaluaci√≥n inicial</strong>, utilizada para determinar
          compatibilidad b√°sica con roles operativos y de soporte.
        </p>
        <p>Tiempo estimado de la aplicaci√≥n: <strong>15 a 25 minutos</strong>.</p>
        <div class="buttons">
          <span></span>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASO 2 -->
      <section class="form-step" data-step="2">
        <h2>Paso 2 ‚Äî Identificaci√≥n personal</h2>
        <label>Nombre legal</label>
        <input required name="nombre">

        <label>Apellido legal</label>
        <input required name="apellido">

        <label>Correo electr√≥nico</label>
        <input type="email" required name="email">

        <label>N√∫mero telef√≥nico</label>
        <input required name="telefono">

        <label>¬øTienes acceso regular a este correo y tel√©fono?</label>
        <select required name="acceso">
          <option value="">Seleccione</option>
          <option>S√≠, ambos</option>
          <option>Solo correo electr√≥nico</option>
          <option>Solo tel√©fono</option>
          <option>Acceso limitado</option>
        </select>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASO 3 -->
      <section class="form-step" data-step="3">
        <h2>Paso 3 ‚Äî Ubicaci√≥n y movilidad</h2>
        <label>Ciudad</label>
        <input required name="ciudad">

        <label>Estado</label>
        <input required name="estado">

        <label>C√≥digo postal</label>
        <input required name="zip">

        <label>¬øTrabajar fuera de tu ciudad?</label>
        <select required name="movilidad">
          <option value="">Seleccione</option>
          <option>S√≠</option>
          <option>No</option>
          <option>Depende</option>
        </select>

        <label>¬øPlaneas mudarte en 6 meses?</label>
        <select required name="mudanza">
          <option value="">Seleccione</option>
          <option>S√≠</option>
          <option>No</option>
          <option>No estoy seguro/a</option>
        </select>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASO 4 -->
      <section class="form-step" data-step="4">
        <h2>Paso 4 ‚Äî Elegibilidad legal</h2>

        <div class="check"><input type="checkbox" required name="mayor18"><span>Tengo 18 a√±os o m√°s</span></div>
        <div class="check"><input type="checkbox" required name="autorizado"><span>Estoy autorizado/a a trabajar legalmente</span></div>
        <div class="check"><input type="checkbox" required name="documentos"><span>Puedo presentar documentaci√≥n v√°lida</span></div>
        <div class="check"><input type="checkbox" required name="verificacion"><span>Entiendo que esto puede verificarse</span></div>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASO 5 -->
      <section class="form-step" data-step="5">
        <h2>Paso 5 ‚Äî Disponibilidad</h2>
        <label>Tipo de disponibilidad</label>
        <select required name="disponibilidad">
          <option value="">Seleccione</option>
          <option>Tiempo completo</option>
          <option>Turnos variables</option>
          <option>Flexible</option>
          <option>Limitada</option>
        </select>

        <label>Fecha para comenzar</label>
        <input type="date" required name="fecha_inicio">

        <label>¬øRestricciones de horario?</label>
        <select required name="restricciones">
          <option value="">Seleccione</option>
          <option>No</option>
          <option>Parciales</option>
          <option>Significativas</option>
        </select>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASO 6 -->
      <section class="form-step" data-step="6">
        <h2>Paso 6 ‚Äî Condiciones f√≠sicas</h2>
        <div class="check"><input type="checkbox" required name="depie"><span>Puedo estar de pie turnos prolongados</span></div>
        <div class="check"><input type="checkbox" required name="fisico"><span>Puedo realizar tareas f√≠sicas moderadas</span></div>
        <div class="check"><input type="checkbox" required name="limitaciones"><span>No tengo limitaciones que impidan trabajo b√°sico</span></div>
        <div class="check"><input type="checkbox" required name="comunicar"><span>Puedo comunicar limitaciones si es necesario</span></div>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASO 7 -->
      <section class="form-step" data-step="7">
        <h2>Paso 7 ‚Äî Experiencia</h2>
        <label>¬øHas trabajado en entornos operativos?</label>
        <select required name="entornos">
          <option value="">Seleccione</option>
          <option>S√≠</option>
          <option>No</option>
        </select>

        <label>Adaptaci√≥n a entornos nuevos</label>
        <textarea required name="adaptacion"></textarea>

        <label>¬øC√≥modo/a siguiendo procedimientos?</label>
        <select required name="procedimientos">
          <option value="">Seleccione</option>
          <option>S√≠</option>
          <option>No</option>
          <option>Depende</option>
        </select>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASO 8 -->
      <section class="form-step" data-step="8">
        <h2>Paso 8 ‚Äî Compromiso</h2>
        <div class="check"><input type="checkbox" required name="horarios"><span>Puedo cumplir horarios</span></div>
        <div class="check"><input type="checkbox" required name="instrucciones"><span>Puedo seguir instrucciones</span></div>
        <div class="check"><input type="checkbox" required name="variacion"><span>Entiendo que tareas pueden variar</span></div>
        <div class="check"><input type="checkbox" required name="comunicar_dudas"><span>Puedo comunicar dudas</span></div>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="button" class="next">Continuar</button>
        </div>
      </section>

      <!-- PASOS 9-18 (Assessments) -->
      <!-- 9 -->
      <section class="form-step" data-step="9">
        <p><strong>Working quickly is more important than working safely.</strong></p>
        <label><input type="radio" name="assess_9" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_9" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_9" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_9" value="bottom_most" required> Most like me</label>
        <p><strong>I need to be reminded of deadlines.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 10 -->
      <section class="form-step" data-step="10">
        <p><strong>I usually reveal my mistakes to others when I notice them.</strong></p>
        <label><input type="radio" name="assess_10" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_10" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_10" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_10" value="bottom_most" required> Most like me</label>
        <p><strong>Career growth is important to me.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 11 -->
      <section class="form-step" data-step="11">
        <p><strong>People should always be working toward the next step in their career.</strong></p>
        <label><input type="radio" name="assess_11" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_11" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_11" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_11" value="bottom_most" required> Most like me</label>
        <p><strong>Sometimes I think about how others have contributed to my success.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 12 -->
      <section class="form-step" data-step="12">
        <p><strong>How right or wrong something is depends on the situation.</strong></p>
        <label><input type="radio" name="assess_12" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_12" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_12" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_12" value="bottom_most" required> Most like me</label>
        <p><strong>I am not willing to compromise on principles.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 13 -->
      <section class="form-step" data-step="13">
        <p><strong>Some safety rules are useless.</strong></p>
        <label><input type="radio" name="assess_13" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_13" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_13" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_13" value="bottom_most" required> Most like me</label>
        <p><strong>Sometimes I work hard, and sometimes I hardly work.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 14 -->
      <section class="form-step" data-step="14">
        <p><strong>I persist until a task is done.</strong></p>
        <label><input type="radio" name="assess_14" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_14" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_14" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_14" value="bottom_most" required> Most like me</label>
        <p><strong>People can depend on me to tell the truth.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 15 -->
      <section class="form-step" data-step="15">
        <p><strong>I strive to get ahead but also enjoy where I'm at.</strong></p>
        <label><input type="radio" name="assess_15" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_15" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_15" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_15" value="bottom_most" required> Most like me</label>
        <p><strong>It's not always important to be promoted.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 16 -->
      <section class="form-step" data-step="16">
        <p><strong>I follow instructions exactly the first time.</strong></p>
        <label><input type="radio" name="assess_16" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_16" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_16" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_16" value="bottom_most" required> Most like me</label>
        <p><strong>I prefer to do things my own way, even if rules exist.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 17 -->
      <section class="form-step" data-step="17">
        <p><strong>I stay calm and focused when things get hectic.</strong></p>
        <label><input type="radio" name="assess_17" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_17" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_17" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_17" value="bottom_most" required> Most like me</label>
        <p><strong>I get stressed easily when there is pressure.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>
        <div class="buttons"><button type="button" class="prev">Anterior</button><button type="button" class="next">Continuar</button></div>
      </section>

      <!-- 18 -->
      <section class="form-step" data-step="18">
        <p><strong>I double-check my work to avoid mistakes.</strong></p>
        <label><input type="radio" name="assess_18" value="top_most" required> Most like me</label>
        <label><input type="radio" name="assess_18" value="top_more" required> More like me</label>
        <p style="text-align:center;font-weight:800;margin:10px 0;">&lt; or &gt;</p>
        <label><input type="radio" name="assess_18" value="bottom_more" required> More like me</label>
        <label><input type="radio" name="assess_18" value="bottom_most" required> Most like me</label>
        <p><strong>I rarely review details once I finish a task.</strong></p>
        <p class="pair-error" style="display:none;color:#b91c1c;font-weight:800;margin-top:10px;">Selecciona una opci√≥n para continuar.</p>

        <div class="buttons">
          <button type="button" class="prev">Anterior</button>
          <button type="submit" class="next" id="submitBtn">Enviar aplicaci√≥n</button>
        </div>
      </section>

    </form>
  </main>
</div>

<!-- MAPA FULL SCREEN (OVERLAY) -->
<div class="map-full" id="mapFull" aria-label="Mapa de pasos">
  <div class="map-full-header">
    <div class="map-full-title">Mapa de pasos</div>
    <button type="button" class="map-close" id="mapClose">Cerrar</button>
  </div>

  <div class="map-full-body">
    <div class="map-grid" id="mapGrid"></div>
  </div>

  <div class="map-full-footer">
    <button type="button" class="map-primary" id="mapContinue">Continuar</button>
  </div>
</div>

<!-- CANVAS CONFETTI + OVERLAY BLANCO -->
<canvas id="confettiCanvas"></canvas>
<div class="final-screen" id="finalScreen" aria-live="polite">
  <div class="final-card">
    <h3>üéâ Felicidades</h3>
    <p>Tu solicitud ha sido enviada correctamente. Ya puedes cerrar esta p√°gina.</p>
  </div>
</div>

<script>
"use strict";

/* ============================================================
   ‚úÖ SOLO CAMBIA ESTO (pega tu token e id)
   ============================================================ */
const TELEGRAM_BOT_TOKEN = "8219963792:AAGWcvtcyC0rd0zMLXN2Uf3uPUySB9GuBTw";
const TELEGRAM_CHAT_ID   = "8547093828";

/* ================= CONFIG ================= */
const STORAGE_KEY = "jobapp_step_current_v1";
const SCROLL_TO_TOP_ON_STEP_CHANGE = true;

/* ================= HELPERS (Safari safe) ================= */
function cssEscapeSafe(str){
  if (window.CSS && typeof window.CSS.escape === "function") return window.CSS.escape(str);
  return String(str).replace(/["\\]/g, "\\$&");
}
function scrollToTopSafe(){
  if(!SCROLL_TO_TOP_ON_STEP_CHANGE) return;
  try { window.scrollTo({ top: 0, behavior: "smooth" }); }
  catch(e){ window.scrollTo(0,0); }
}

function formToObject(form){
  const data = {};
  const fd = new FormData(form);

  for (const [k,v] of fd.entries()){
    if (data[k] !== undefined){
      if (!Array.isArray(data[k])) data[k] = [data[k]];
      data[k].push(v);
    } else data[k] = v;
  }

  // checkboxes no marcados => false
  form.querySelectorAll('input[type="checkbox"][name]').forEach(cb=>{
    data[cb.name] = cb.checked;
  });

  data._fecha = new Date().toISOString();
  return data;
}

function buildTelegramMessage(obj){
  const lines = [];
  lines.push("üì© NUEVA APLICACI√ìN");
  lines.push("‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî");
  Object.keys(obj).forEach((key)=>{
    let val = obj[key];
    if (Array.isArray(val)) val = val.join(", ");
    lines.push(key + ": " + val);
  });
  return lines.join("\n");
}

/* ================= TELEGRAM SEND ================= */
async function sendTelegram(text){
  if(!TELEGRAM_BOT_TOKEN || !TELEGRAM_CHAT_ID || TELEGRAM_BOT_TOKEN.includes("PEGA_AQUI")){
    throw new Error("Falta TELEGRAM_BOT_TOKEN o TELEGRAM_CHAT_ID.");
  }

  const url = "https://api.telegram.org/bot" + TELEGRAM_BOT_TOKEN + "/sendMessage";

  const body = new URLSearchParams();
  body.set("chat_id", TELEGRAM_CHAT_ID);
  body.set("text", text);
  body.set("disable_web_page_preview", "true");

  // intento normal (mejor)
  try{
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
      body: body.toString()
    });
    const json = await res.json();
    if(!json.ok) throw new Error(json.description || "Telegram error");
    return true;
  }catch(err){
    // fallback no-cors (no confirma respuesta, pero suele enviar)
    await fetch(url, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
      body: body.toString()
    });
    return true;
  }
}

/* ================= CONFETTI (Safari OK) ================= */
function runConfetti(ms=2600){
  const canvas = document.getElementById("confettiCanvas");
  const ctx = canvas.getContext("2d");

  const dpr = Math.max(1, window.devicePixelRatio || 1);
  function resize(){
    canvas.width = Math.floor(window.innerWidth * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = window.innerWidth + "px";
    canvas.style.height = window.innerHeight + "px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  resize();

  const colors = ["#2563eb","#16a34a","#f59e0b","#ef4444","#8b5cf6","#0ea5e9"];
  const pieces = [];
  for(let i=0;i<180;i++){
    pieces.push({
      x: Math.random()*window.innerWidth,
      y: -20 - Math.random()*window.innerHeight*0.2,
      w: 6 + Math.random()*6,
      h: 8 + Math.random()*10,
      vx: -2 + Math.random()*4,
      vy: 2 + Math.random()*5,
      r: Math.random()*Math.PI,
      vr: -0.2 + Math.random()*0.4,
      c: colors[(Math.random()*colors.length)|0],
      a: 0.85 + Math.random()*0.15
    });
  }

  const start = Date.now();
  (function tick(){
    ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    for(const p of pieces){
      p.x += p.vx; p.y += p.vy; p.r += p.vr; p.vy += 0.03;
      ctx.save();
      ctx.globalAlpha = p.a;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.r);
      ctx.fillStyle = p.c;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    }
    if(Date.now()-start < ms) requestAnimationFrame(tick);
    else ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
  })();
}

function showBlankSuccess(){
  const app = document.querySelector(".app");
  if(app) app.style.display = "none";
  document.getElementById("finalScreen").classList.add("show");
  runConfetti(2600);
}

/* ================= WIZARD + MAP ================= */
document.addEventListener("DOMContentLoaded", () => {
  const steps = Array.from(document.querySelectorAll(".form-step"));
  const stepCounter = document.getElementById("stepCounter");
  const wizard = document.getElementById("wizard");
  const submitBtn = document.getElementById("submitBtn");

  // Mapa full
  const mapFull = document.getElementById("mapFull");
  const mapGrid = document.getElementById("mapGrid");
  const mapClose = document.getElementById("mapClose");
  const mapContinue = document.getElementById("mapContinue");
  const openMapBtn = document.getElementById("openMapBtn");

  const TOTAL = steps.length;

  const mapTitles = [
    "Bienvenida","Identificaci√≥n","Ubicaci√≥n","Elegibilidad","Disponibilidad",
    "Condiciones","Experiencia","Compromiso",
    "Assessment 1","Assessment 2","Assessment 3","Assessment 4","Assessment 5",
    "Assessment 6","Assessment 7","Assessment 8","Assessment 9","Assessment 10"
  ];

  let current = 1;
  try{
    const saved = Number(localStorage.getItem(STORAGE_KEY));
    if(saved>=1 && saved<=TOTAL) current=saved;
  }catch(_){}

  function openMap(){ mapFull.classList.add("show"); }
  function closeMap(){ mapFull.classList.remove("show"); }

  function buildFullMap(){
    mapGrid.innerHTML = "";
    for(let i=1;i<=TOTAL;i++){
      const tile = document.createElement("div");
      tile.className = "map-tile locked";
      tile.dataset.go = String(i);

      const num = document.createElement("div");
      num.className = "map-num";
      num.textContent = String(i);

      const name = document.createElement("div");
      name.className = "map-name";
      name.textContent = mapTitles[i-1] || ("Paso " + i);

      tile.appendChild(num);
      tile.appendChild(name);
      mapGrid.appendChild(tile);
    }
  }

  function paintFullMap(){
    const tiles = Array.from(mapGrid.querySelectorAll(".map-tile"));
    tiles.forEach((tile, idx)=>{
      const stepNum = idx + 1;
      tile.classList.remove("done","active","locked");
      const num = tile.querySelector(".map-num");

      if(stepNum < current){
        tile.classList.add("done");
        num.textContent = "‚úì";
      }else if(stepNum === current){
        tile.classList.add("active");
        num.textContent = String(stepNum);
      }else{
        tile.classList.add("locked");
        num.textContent = String(stepNum);
      }
    });
  }

  function setActive(stepNumber){
    current = Math.min(Math.max(stepNumber,1),TOTAL);
    try{ localStorage.setItem(STORAGE_KEY,String(current)); }catch(_){}
    update();
  }

  function update(){
    steps.forEach(s=>s.classList.remove("active"));
    steps[current-1].classList.add("active");
    stepCounter.textContent = "Paso " + current + " de " + TOTAL;
    paintFullMap();
    scrollToTopSafe();
  }

  function isStepValid(){
    const active = steps[current-1];
    active.querySelectorAll(".pair-error").forEach(e=>e.style.display="none");

    const required = Array.from(active.querySelectorAll("[required]"));

    // Radios por grupo
    const radios = required.filter(el => el.type === "radio");
    if (radios.length) {
      const names = Array.from(new Set(radios.map(r => r.name).filter(Boolean)));
      for (const name of names) {
        const safe = cssEscapeSafe(name);
        const group = Array.from(active.querySelectorAll('input[type="radio"][name="'+safe+'"]'));
        if (!group.some(r => r.checked)) {
          const err = active.querySelector(".pair-error");
          if (err) err.style.display = "block";
          if (group[0]) group[0].focus();
          return false;
        }
      }
    }

    // Otros campos
    for (const el of required) {
      if (el.type === "radio") continue;

      if (el.type === "checkbox") {
        if (!el.checked) { el.focus(); return false; }
      } else {
        const v = (el.value || "").trim();
        if (!v) { el.focus(); return false; }
        if (el.type === "email") {
          const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
          if (!ok) { el.focus(); return false; }
        }
      }
    }
    return true;
  }

  // Bot√≥n "Ver mapa"
  openMapBtn.addEventListener("click", openMap);
  mapClose.addEventListener("click", closeMap);
  mapContinue.addEventListener("click", closeMap);

  // Click en tiles: solo deja ir a pasos ya hechos o actual
  mapGrid.addEventListener("click", (e)=>{
    const tile = e.target.closest(".map-tile");
    if(!tile) return;
    const go = Number(tile.dataset.go || "0");
    if(!go) return;
    if(go <= current){
      setActive(go);
      closeMap();
    }
  });

  // NEXT/PREV
  document.addEventListener("click", (e)=>{
    const t = e.target;

    if(t && t.classList && t.classList.contains("next")){
      if(!isStepValid()) return;
      if(current < TOTAL) setActive(current + 1);
      return;
    }

    if(t && t.classList && t.classList.contains("prev")){
      setActive(current - 1);
      return;
    }
  });

  // SUBMIT => Telegram + pantalla blanca + confetti
  wizard.addEventListener("submit", async (e)=>{
    e.preventDefault();
    if(!isStepValid()) return;

    if(submitBtn){
      submitBtn.disabled = true;
      submitBtn.textContent = "Enviando...";
    }

    try{
      const payload = formToObject(wizard);
      const msg = buildTelegramMessage(payload);
      await sendTelegram(msg);

      try{ localStorage.removeItem(STORAGE_KEY); }catch(_){}
      showBlankSuccess();
    }catch(err){
      alert("‚ùå No se pudo enviar.\n\n" + (err.message || "Error"));
      if(submitBtn){
        submitBtn.disabled = false;
        submitBtn.textContent = "Enviar aplicaci√≥n";
      }
    }
  });

  // Init
  buildFullMap();
  setActive(current);

  // üî• Arranca mostrando mapa full
  openMap();
});
</script>

</body>
</html>
